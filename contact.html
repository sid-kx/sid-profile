<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact — Sid</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.min.js"></script>
</head>
<body>
    <div id="animated-background"></div>

    <header id="navbar">
        <div class="container">
            <a class='logo' href='index.html'><i data-lucide="code-2"></i><span>Sid</span></a>
            <nav>
                <a href='index.html'>Home</a>
                <a href='projects.html'>Projects</a>
                <a href='experiences.html'>Experiences</a>
                <a href='about.html'>About</a>
            </nav>
            <div class="nav-buttons">
                <button id="theme-toggle" class="btn btn-ghost"><i data-lucide="moon" class="icon-moon"></i><i data-lucide="sun" class="icon-sun"></i></button>
                <a class='btn btn-secondary' href='contact.html'>Contact Me</a>
                <button id="mobile-menu-toggle" class="btn btn-ghost mobile-only" aria-label="Open menu" aria-controls="mobile-menu" aria-expanded="false"><i data-lucide="menu"></i></button>
            </div>
        </div>
    </header>
    
    
    <div id="mobile-menu">
        <div class="mobile-menu-header">
            <a class="logo" href="index.html">
            <i data-lucide="code-2"></i>
            <span>Sid</span>
            </a>

            <button id="mobile-menu-close" class="btn btn-ghost" aria-label="Close menu" aria-controls="mobile-menu" aria-expanded="true">
            <i data-lucide="x"></i>
            </button>
        </div>

        <nav>
            <a href="index.html">Home</a>
            <a href="projects.html">Projects</a>
            <a href="experiences.html">Experiences</a>
            <a href="about.html">About</a>
            <a class="btn btn-secondary" href="contact.html">Contact Me</a>
        </nav>
    </div>
    <main>
        <section class="page-hero animated-section is-visible">
            <div class="container text-center">
                <h1 class="section-title">Let's Build Something</h1>
                <p class="section-subtitle">Have a project in mind or just want to connect? Send me a message.</p>
            </div>
        </section>

        <section id="contact" class="animated-section is-visible">
            <div class="container">
                <form id="contact-form" class="contact-form" novalidate>
                    <div class="form-group">
                        <label for="name">Name</label>
                        <input type="text" id="name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="message">Message</label>
                        <textarea id="message" name="message" rows="5" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary btn-lg">Send Message</button>
                    <p id="form-status" class="section-subtitle" style="margin-top: 1rem; text-align:center;"></p>
                </form>
            </div>
        </section>
    </main>
    
    <footer class="site-footer">
        <div class="container">
            <div class="footer-socials">
                <a href="contact.html#" target="_blank" aria-label="LinkedIn"><i data-lucide="linkedin"></i></a>
                <a href="contact.html#" target="_blank" aria-label="GitHub"><i data-lucide="github"></i></a>
                <a href="contact.html#" target="_blank" aria-label="X (Twitter)"><i data-lucide="twitter"></i></a>
                <a href="contact.html#" target="_blank" aria-label="Instagram"><i data-lucide="instagram"></i></a>
            </div>
            <p>&copy; 2026 Sidhant Kamboj. All rights reserved.</p>
            <p>Built with love & caffeine in Brampton, ON.</p>
        </div>
    </footer>

    <script src="assets/js/main.js"></script>
    <script>
      (function () {
        const form = document.getElementById('contact-form');
        const statusEl = document.getElementById('form-status');

        // Use localhost while testing, and your deployed URL when live.
        // IMPORTANT: After deploying backend (Render/Railway), replace the production URL below.
        const PROD_API_BASE = 'https://sid-contact-backend.onrender.com';
        const isLocal = ['localhost', '127.0.0.1'].includes(window.location.hostname);
        const API_BASE = isLocal ? 'http://localhost:3000' : PROD_API_BASE;

        async function sendMessage(payload) {
          const controller = new AbortController();
          const timeoutMs = 20000; // 20s (Render free tier may take a moment to wake)
          const timer = setTimeout(() => controller.abort(), timeoutMs);

          try {
            const res = await fetch(`${API_BASE}/api/contact`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload),
              signal: controller.signal
            });

            const json = await res.json().catch(() => ({}));

            if (!res.ok || !json.ok) {
              throw new Error(json.error || 'Failed to send message.');
            }

            return json;
          } catch (err) {
            // Handle fetch abort (timeout)
            if (err?.name === 'AbortError') {
              throw new Error('Server took too long to respond (it may be waking up). Please try again.');
            }
            throw err;
          } finally {
            clearTimeout(timer);
          }
        }

        form.addEventListener('submit', async (e) => {
          e.preventDefault();

          const name = document.getElementById('name')?.value?.trim();
          const email = document.getElementById('email')?.value?.trim();
          const message = document.getElementById('message')?.value?.trim();

          if (!name || !email || !message) {
            statusEl.textContent = '❌ Please fill in all fields.';
            return;
          }

          const button = form.querySelector('button[type="submit"]');
          if (button) {
            button.disabled = true;
            button.textContent = 'Sending…';
          }
          statusEl.textContent = 'Sending…';

          try {
            await sendMessage({ name, email, message });
            statusEl.textContent = '✅ Message sent! I’ll reply soon.';
            form.reset();
          } catch (err) {
            statusEl.textContent = `❌ ${err.message || 'Network error. Try again.'}`;
          } finally {
            if (button) {
              button.disabled = false;
              button.textContent = 'Send Message';
            }
          }
        });
      })();
    </script>
</body>
</html>
